# Copyright (c) 2020 Oracle and/or its affiliates.
# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.

title: "CIS OCI Landing Zone Config Stack"
stackDescription: "A Resource Manager Stack to deploy a set of CIS compliant resources in an OCI tenancy."
schemaVersion: 1.1.0
version: "0.0.1"
locale: "en"

variableGroups:
  - title: "Environment"
    variables:
      - "region"
      - "service_label"

  - title: "Enclosing Compartment"
    variables:
      - "use_enclosing_compartment"
      - "existing_enclosing_compartment_ocid"

  - title: "Landing Zone Policies & Groups"
    variables:
      - "use_existing_tenancy_policies"
      - "use_existing_iam_groups"

  - title: "Existing Groups"
    variables:
      - "existing_iam_admin_group_name"
      - "existing_cred_admin_group_name"
      - "existing_security_admin_group_name"
      - "existing_network_admin_group_name"
      - "existing_appdev_admin_group_name"
      - "existing_database_admin_group_name"
      - "existing_auditor_group_name"
      - "existing_announcement_reader_group_name"
    visible: use_existing_iam_groups    

  - title: "Network"
    variables:
      - "vcn_cidr"
      - "public_subnet_cidr"
      - "private_subnet_app_cidr"
      - "private_subnet_db_cidr"
      - "public_src_bastion_cidr"
      - "public_src_lbr_cidr"
      - "is_vcn_onprem_connected"
      - "onprem_cidr"

  - title: "Notifications"
    variables:
      - "network_admin_email_endpoint"
      - "security_admin_email_endpoint"

  - title: "Cloud Guard"
    variables:
      - "cloud_guard_configuration_status"
    
  - title: "Hidden Variables"
    visible: false
    variables:
      - "tenancy_ocid"
      - "user_ocid"
      - "fingerprint"
      - "private_key_path"
      - "private_key_password"

variables:
  service_label:
    type: string
    title: "Service Label"
    minLength: 1
    maxLength: 8
    pattern: "^[A-Za-z][A-Za-z0-9]{1,7}$"
    description: "A unique label that gets prepended to all resources created by the Landing Zone"
    required: true

  region:
    type: oci:identity:region:name
    title: "Region"
    description: "The region for resources deployment"
    required: true

  use_enclosing_compartment:
    type: boolean
    title: "Use an enclosing compartment?"
    description: "Whether or not the Landing Zone compartments are created within an enclosing compartment. If unchecked, the Landing Zone compartments are created under the root compartment."
    default: false

  existing_enclosing_compartment_ocid:
    type: oci:identity:compartment:id
    title: "Existing enclosing compartment"
    description: "The enclosing compartment where Landing Zone compartments will be created. If not provided and \"Use enclosing compartment?\" is checked, an enclosing compartment is created under the root compartment."
    required: false 
    visible: use_enclosing_compartment 

#  use_existing_tenancy_policies:
#    type: boolean
#    title: "Use existing policies in the root compartment?"
#    description: "Whether or not required policies have already been created at the root compartment and must just be assigned to the Landing Zone groups. If unchecked, you must be sure the user executing this stack has permissions to create policies in the root compartment."
#    default: false
#    required: true

  policies_in_root_compartment:
    type: enum
    title: "CREATE or USE policies in the root compartment?"
    description: "Whether policies in the root compartment should be created or simply used. If \"CREATE\", you must be sure the user executing this stack has permissions to create policies in the root compartment. If \"USE\", policies must have been created previously."
    enum:
      - "CREATE"
      - "USE"
    required: true
    default: "CREATE"
      
  use_existing_iam_groups:
    type: boolean
    title: "Use existing groups?"
    description: "Whether or not existing groups are to be reused for this Landing Zone. If unchecked, one set of groups is created. If checked, existing group names must be provided and this set will be able to manage resources in this Landing Zone."
    default: false
    required: true
  
  existing_iam_admin_group_name:
    type: string
    title: "Existing IAM admin group name"
    description: "Existing group to which IAM management policies will be granted to."
    
  existing_cred_admin_group_name:
    type: string
    title: "Existing credentials admin group name"
    description: "Existing group to which credentials management policies will be granted to."
      
  existing_security_admin_group_name:
    type: string
    title: "Existing security admin group name"
    description: "Existing group to which security management policies will be granted to."
      
  existing_network_admin_group_name:
    type: string
    title: "Existing network admin group name"
    description: "Existing group to which network management policies will be granted to."
      
  existing_appdev_admin_group_name:
    type: string
    title: "Existing application development admin group name"
    description: "Existing group to which application development management policies will be granted to."
      
  existing_database_admin_group_name:
    type: string
    title: "Existing database admin group name"
    description: "Existing group to which database management policies will be granted to."
      
  existing_auditor_group_name:
    type: string
    title: "Existing auditors group name"
    description: "Existing group to which auditing policies will be granted to."
      
  existing_announcement_reader_group_name:
    type: string
    title: "Existing announcement readers group name"
    description: "Existing group to which annoucement reading policies will be granted to."  
  
  vcn_cidr:
    type: string
    title: "VCN CIDR Block"
    required: true
    default: "10.0.0.0/16"
    pattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$"
    description: "Network IP range in CIDR notation"

  public_subnet_cidr:
    type: string
    title: "Public Subnet IP Range"
    required: true
    default: "10.0.1.0/24"
    pattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$"
    description: "IP range of public subnet; Must be in VCN CIDR range"

  private_subnet_app_cidr:
    type: string
    title: "Private Application Subnet IP Range"
    required: true
    default: "10.0.2.0/24"
    pattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$"
    description: "IP range of application subnet; Must be in VCN CIDR range"

  private_subnet_db_cidr:
    type: string
    title: "Private Database Subnet IP Range"
    required: true
    default: "10.0.3.0/24"
    pattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$"
    description: "IP range of database subnet; Must be in VCN CIDR range"

  public_src_bastion_cidr:
    type: string
    title: "Bastion Grant CIDR"
    required: true
    pattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$"
    description: "External IP range allowed to connect to bastion host; Cannot be 0.0.0.0/0"

  public_src_lbr_cidr:
    type: string
    title: "Load Balancer Grant CIDR"
    required: true
    default: "0.0.0.0/0"
    pattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$"
    description: "External IP range allowed to connect to public load balancer"

  is_vcn_onprem_connected:
    type: boolean
    title: "Connect to On-Premises Network?"
    default: false

  onprem_cidr:
    type: string
    title: "On-Premises Network CIDR"
    pattern: "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$"
    visible: is_vcn_onprem_connected
    description: "IP range of your on-premises network in CIDR notation; Must not conflict with VCN CIDR Block range."

  network_admin_email_endpoint:
    type: string
    title: "Network Admin Email Address"
    pattern: "^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$"
    required: true
    description: "Recipient for all network notifications"

  security_admin_email_endpoint:
    type: string
    title: "Security Admin Email Address"
    pattern: "^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$"
    required: true
    description: "Recipient for all securtiy notifications"

  cloud_guard_configuration_status:
    type: enum
    title: "Cloud Guard Configuration Status"
    description: "Whether or not to activate Cloud Guard as part of Landing Zone deployment"
    enum:
      - ENABLED
      - DISABLED
      
  # Variables not required to display to user
  user_ocid:
    type: string

  fingerprint:
    type: string

  private_key_path:
    type: string

  private_key_password:
    type: password